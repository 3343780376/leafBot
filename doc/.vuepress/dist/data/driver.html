<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>driver列表 | LeafBot</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="一个onebot的sdk">
    
    <link rel="preload" href="/leafBot/assets/css/0.styles.4e1768a2.css" as="style"><link rel="preload" href="/leafBot/assets/js/app.3cd288c0.js" as="script"><link rel="preload" href="/leafBot/assets/js/2.94db82d2.js" as="script"><link rel="preload" href="/leafBot/assets/js/10.63a16882.js" as="script"><link rel="prefetch" href="/leafBot/assets/js/11.5bc0f838.js"><link rel="prefetch" href="/leafBot/assets/js/3.ac3d1341.js"><link rel="prefetch" href="/leafBot/assets/js/4.bcce06fb.js"><link rel="prefetch" href="/leafBot/assets/js/5.360ce046.js"><link rel="prefetch" href="/leafBot/assets/js/6.21f7db24.js"><link rel="prefetch" href="/leafBot/assets/js/7.5015e266.js"><link rel="prefetch" href="/leafBot/assets/js/8.efbff6cc.js"><link rel="prefetch" href="/leafBot/assets/js/9.b6ef1c5d.js">
    <link rel="stylesheet" href="/leafBot/assets/css/0.styles.4e1768a2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/leafBot/" class="home-link router-link-active"><!----> <span class="site-name">LeafBot</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/leafBot/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/leafBot/data/quick_start.html" class="nav-link">
  Quick Start
</a></div><div class="nav-item"><a href="/leafBot/data/driver.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Driver
</a></div><div class="nav-item"><a href="/leafBot/data/config.html" class="nav-link">
  Config
</a></div><div class="nav-item"><a href="https://github.com/huoxue1/leafBot" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Languages" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Languages" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/leafBot/language/chinese.html" class="nav-link">
  Chinese
</a></li><li class="dropdown-item"><!----> <a href="/leafBot/language/japanese.html" class="nav-link">
  Japanese
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/leafBot/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/leafBot/data/quick_start.html" class="nav-link">
  Quick Start
</a></div><div class="nav-item"><a href="/leafBot/data/driver.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Driver
</a></div><div class="nav-item"><a href="/leafBot/data/config.html" class="nav-link">
  Config
</a></div><div class="nav-item"><a href="https://github.com/huoxue1/leafBot" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Languages" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Languages" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/leafBot/language/chinese.html" class="nav-link">
  Chinese
</a></li><li class="dropdown-item"><!----> <a href="/leafBot/language/japanese.html" class="nav-link">
  Japanese
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>driver列表</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/leafBot/data/driver.html#cqhttp-http-driver" class="sidebar-link">cqhttp-http-driver</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/leafBot/data/driver.html#gocq关键配置" class="sidebar-link">gocq关键配置</a></li><li class="sidebar-sub-header"><a href="/leafBot/data/driver.html#leafbot关键配置" class="sidebar-link">leafBot关键配置</a></li></ul></li><li><a href="/leafBot/data/driver.html#cqhttp-positive-ws-driver" class="sidebar-link">cqhttp-positive-ws-driver</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/leafBot/data/driver.html#gocq关键配置-2" class="sidebar-link">gocq关键配置</a></li><li class="sidebar-sub-header"><a href="/leafBot/data/driver.html#leafbot关键配置-2" class="sidebar-link">leafBot关键配置</a></li></ul></li><li><a href="/leafBot/data/driver.html#cqhttp-reverse-ws-driver" class="sidebar-link">cqhttp-reverse-ws-driver</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/leafBot/data/driver.html#gocq关键配置-3" class="sidebar-link">gocq关键配置</a></li><li class="sidebar-sub-header"><a href="/leafBot/data/driver.html#leafbot关键配置-3" class="sidebar-link">leafBot关键配置</a></li></ul></li><li><a href="/leafBot/data/driver.html#自定义实现" class="sidebar-link">自定义实现</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="driver列表"><a href="#driver列表" class="header-anchor">#</a> driver列表</h1> <h2 id="cqhttp-http-driver"><a href="#cqhttp-http-driver" class="header-anchor">#</a> cqhttp-http-driver</h2> <p>通过http通信方式与onebot端进行通信。</p> <p>gocq的host和port配置分别对应leafBot的post_host和post_port</p> <p>gocq的url配置分别对应leafBot的listen_host和listen_port</p> <blockquote><p>使用http链接方式可能会使oncnnect和ondisconnect插件失效</p></blockquote> <h3 id="gocq关键配置"><a href="#gocq关键配置" class="header-anchor">#</a> gocq关键配置</h3> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">servers</span><span class="token punctuation">:</span>
  <span class="token comment"># HTTP 通信设置</span>
  <span class="token punctuation">-</span> <span class="token key atrule">http</span><span class="token punctuation">:</span>
      <span class="token comment"># 是否关闭正向HTTP服务器</span>
      <span class="token key atrule">disabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
      <span class="token comment"># 服务端监听地址</span>
      <span class="token key atrule">host</span><span class="token punctuation">:</span> 127.0.0.1
      <span class="token comment"># 服务端监听端口</span>
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">5700</span>
      <span class="token comment"># 反向HTTP超时时间, 单位秒</span>
      <span class="token comment"># 最小值为5，小于5将会忽略本项设置</span>
      <span class="token key atrule">timeout</span><span class="token punctuation">:</span> <span class="token number">5</span>
      <span class="token key atrule">middlewares</span><span class="token punctuation">:</span>
        <span class="token key atrule">&lt;&lt;</span><span class="token punctuation">:</span> <span class="token important">*default</span> <span class="token comment"># 引用默认中间件</span>
      <span class="token comment"># 反向HTTP POST地址列表</span>
      <span class="token key atrule">post</span><span class="token punctuation">:</span>
        <span class="token comment">#- url: '' # 地址</span>
        <span class="token comment">#  secret: ''           # 密钥</span>
        <span class="token punctuation">-</span> <span class="token key atrule">url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span><span class="token number">8081</span> <span class="token comment"># 地址</span>
        <span class="token comment">#  secret: ''          # 密钥</span>

</code></pre></div><h3 id="leafbot关键配置"><a href="#leafbot关键配置" class="header-anchor">#</a> leafBot关键配置</h3> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">listen_host</span><span class="token punctuation">:</span> 127.0.0.1

<span class="token key atrule">listen_port</span><span class="token punctuation">:</span> <span class="token number">8081</span>

<span class="token comment"># cqhttp_http_driver相关配置</span>
<span class="token key atrule">web_hook</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span>
        <span class="token key atrule">post_host</span><span class="token punctuation">:</span> 127.0.0.1
        <span class="token key atrule">post_port</span><span class="token punctuation">:</span> <span class="token number">5700</span>
        <span class="token key atrule">self_id</span><span class="token punctuation">:</span> <span class="token number">1603214019</span>
</code></pre></div><h2 id="cqhttp-positive-ws-driver"><a href="#cqhttp-positive-ws-driver" class="header-anchor">#</a> cqhttp-positive-ws-driver</h2> <p>gocq作为服务端，leafBot最为客户端，通过websocket的链接方式进行通信</p> <blockquote><p>使用正向ws会导致不能一个leafBot链接多个gocq</p></blockquote> <h3 id="gocq关键配置-2"><a href="#gocq关键配置-2" class="header-anchor">#</a> gocq关键配置</h3> <div class="language-yaml extra-class"><pre class="language-yaml"><code>
<span class="token comment"># 正向WS设置</span>
<span class="token punctuation">-</span> <span class="token key atrule">ws</span><span class="token punctuation">:</span>
    <span class="token comment"># 是否禁用正向WS服务器</span>
    <span class="token key atrule">disabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token comment"># 正向WS服务器监听地址</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> 127.0.0.1
    <span class="token comment"># 正向WS服务器监听端口</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
    <span class="token key atrule">middlewares</span><span class="token punctuation">:</span>
      <span class="token key atrule">&lt;&lt;</span><span class="token punctuation">:</span> <span class="token important">*default</span> <span class="token comment"># 引用默认中间件</span>

</code></pre></div><h3 id="leafbot关键配置-2"><a href="#leafbot关键配置-2" class="header-anchor">#</a> leafBot关键配置</h3> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token comment"># bot运行地址，若和gocq在同一台机器则只需要填写127.0.0.1即可，否则填写0.0.0.0，gocq配置你的公网地址</span>
<span class="token key atrule">host</span><span class="token punctuation">:</span> 127.0.0.1
<span class="token comment"># bot运行端口</span>
<span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
</code></pre></div><h2 id="cqhttp-reverse-ws-driver"><a href="#cqhttp-reverse-ws-driver" class="header-anchor">#</a> cqhttp-reverse-ws-driver</h2> <p>gocq作为客户端，leafBot作为服务的，通过websocket的链接方式进行通信</p> <blockquote><p>推荐使用方式，可支持多q</p></blockquote> <h3 id="gocq关键配置-3"><a href="#gocq关键配置-3" class="header-anchor">#</a> gocq关键配置</h3> <div class="language-yaml extra-class"><pre class="language-yaml"><code>
<span class="token punctuation">-</span> <span class="token key atrule">ws-reverse</span><span class="token punctuation">:</span>
    <span class="token comment"># 是否禁用当前反向WS服务</span>
    <span class="token key atrule">disabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token comment"># 反向WS Universal 地址</span>
    <span class="token comment"># 注意 设置了此项地址后下面两项将会被忽略</span>
    <span class="token key atrule">universal</span><span class="token punctuation">:</span> ws<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>8080/cqhttp/ws
    <span class="token comment"># 反向WS API 地址</span>
    <span class="token key atrule">api</span><span class="token punctuation">:</span> ws<span class="token punctuation">:</span>//your_websocket_api.server
    <span class="token comment"># 反向WS Event 地址</span>
    <span class="token key atrule">event</span><span class="token punctuation">:</span> ws<span class="token punctuation">:</span>//your_websocket_event.server
    <span class="token comment"># 重连间隔 单位毫秒</span>
    <span class="token key atrule">reconnect-interval</span><span class="token punctuation">:</span> <span class="token number">3000</span>
    <span class="token key atrule">middlewares</span><span class="token punctuation">:</span>
      <span class="token key atrule">&lt;&lt;</span><span class="token punctuation">:</span> <span class="token important">*default</span> <span class="token comment"># 引用默认中间件</span>

</code></pre></div><h3 id="leafbot关键配置-3"><a href="#leafbot关键配置-3" class="header-anchor">#</a> leafBot关键配置</h3> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token comment"># bot运行地址，若和gocq在同一台机器则只需要填写127.0.0.1即可，否则填写0.0.0.0，gocq配置你的公网地址</span>
<span class="token key atrule">host</span><span class="token punctuation">:</span> 127.0.0.1
<span class="token comment"># bot运行端口</span>
<span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
</code></pre></div><h2 id="自定义实现"><a href="#自定义实现" class="header-anchor">#</a> 自定义实现</h2> <p>leafBot定义了一套关于driver的接口</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// Driver</span>
<span class="token comment">// @Description:</span>
<span class="token comment">//</span>
<span class="token keyword">type</span> Driver <span class="token keyword">interface</span> <span class="token punctuation">{</span>
	<span class="token comment">// Run</span>
	<span class="token comment">// @Description: 运行该驱动的接口，该接口应该为阻塞式运行</span>
	<span class="token comment">//</span>
	<span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// GetEvent</span>
	<span class="token comment">// @Description: 返回一个chan，该chan为事件传递的chan</span>
	<span class="token comment">// @return chan</span>
	<span class="token comment">//</span>
	<span class="token function">GetEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">chan</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span>

	<span class="token function">OnConnect</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>selfId <span class="token builtin">int64</span><span class="token punctuation">,</span> host <span class="token builtin">string</span><span class="token punctuation">,</span> clientRole <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token function">OnDisConnect</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>selfId <span class="token builtin">int64</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

	<span class="token comment">// GetBot</span>
	<span class="token comment">// @Description: 获取一个实现了APi接口的bot</span>
	<span class="token comment">// @param int64 bot的id</span>
	<span class="token comment">// @return interface{}</span>
	<span class="token comment">//</span>
	<span class="token function">GetBot</span><span class="token punctuation">(</span><span class="token builtin">int64</span><span class="token punctuation">)</span> <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
	<span class="token comment">// GetBots</span>
	<span class="token comment">// @Description: 获取所有bot</span>
	<span class="token comment">// @return map[int64]interface{}</span>
	<span class="token comment">//</span>
	<span class="token function">GetBots</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">int64</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
	
	<span class="token comment">// 设置一些配置信息</span>
	<span class="token function">SetConfig</span><span class="token punctuation">(</span>config <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token comment">// 添加一个webhook监听</span>
	<span class="token function">AddWebHook</span><span class="token punctuation">(</span>selfID <span class="token builtin">int64</span><span class="token punctuation">,</span> postHost <span class="token builtin">string</span><span class="token punctuation">,</span> postPort <span class="token builtin">int</span><span class="token punctuation">)</span>
	<span class="token comment">// 配置access——token</span>
	<span class="token function">SetToken</span><span class="token punctuation">(</span>token <span class="token builtin">string</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>实现该接口即可作为leafBot的driver进行加载</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/leafBot/assets/js/app.3cd288c0.js" defer></script><script src="/leafBot/assets/js/2.94db82d2.js" defer></script><script src="/leafBot/assets/js/10.63a16882.js" defer></script>
  </body>
</html>
